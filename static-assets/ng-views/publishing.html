<!--
  ~ Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License version 3 as published by
  ~ the Free Software Foundation.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public License
  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->

<div class="publishing-view">
  <h2 class="page-header">{{ 'admin.publishing.PUBLISHING' | translate }}</h2>

  <tabset>
    <tab id="publishingTab">
      <tab-heading>
        <span class="mr10 fa fa-cloud-upload"></span>{{ 'admin.publishing.STATUS' | translate }}
      </tab-heading>
      <div class="m10 mt25">
        <div id="publisherDashboard"></div>
        <div class="publish-buttons mt20">
          <input
            class="btn btn-default mr10"
            id="stopPublish"
            ng-click="publish.stopPublish()"
            ng-disabled="publish.stopDisabled"
            type="button"
            value="Stop"
          />
          <input
            class="btn btn-primary"
            id="startPublish"
            ng-click="publish.startPublish()"
            ng-disabled="publish.startDisabled"
            type="button"
            value="Start"
          />
        </div>
      </div>
    </tab>
    <tab active="tab.active" disabled="tab.disabled" id="bulkTab">
      <tab-heading>
        <span class="mr10 fa fa-arrows-alt"></span>{{ 'admin.publishing.BULKPUBLISH' | translate }}
      </tab-heading>
      <div class="m10 mt25 bulkContainer">
        <h3 class="mt5 mb15">{{ 'admin.publishing.BULKPUBLISH' | translate }}</h3>

        <form class="ng-dirty ng-invalid ng-invalid-required" id="bulk-form" name="bulkOperationForm" novalidate>
          <div class="panel">
            <div class="panel-body">
              <div class="form-group">
                <label class="control-label" for="bulkPath">{{ 'admin.publishing.PATHPUBLISH' | translate }}</label>
                <span class="validationComment">{{ 'admin.publishing.PATHEXAMPLE' | translate }}</span>
                <input
                  class="form-control"
                  focus-me="true"
                  id="bulkPath"
                  name="bulkPath"
                  ng-model="publish.pathPublish"
                  required
                  type="text"
                />
                <div
                  class="error-container"
                  ng-show="(bulkOperationForm.bulkPath.$dirty && bulkOperationForm.bulkPath.$invalid) || (bulkOperationForm.bulkPath.$touched && bulkOperationForm.bulkPath.$invalid)"
                >
                  <small class="error" ng-show="bulkOperationForm.bulkPath.$error.required">
                    {{ 'admin.publishing.PATH' | translate }} {{ 'common.IS_REQUIRED_LABEL' | translate }}
                  </small>
                </div>
              </div>

              <div class="form-group">
                <label class="control-label" for="bulkChannel"
                  >{{ 'admin.publishing.PUBLISHINGENVIRONMENT' | translate }}</label
                >
                <select
                  class="form-control"
                  id="bulkChannel"
                  name="bulkChannel"
                  ng-model="publish.selectedChannel"
                  ng-options="item.name as item.name for item in publish.channels"
                >
                </select>
                <div
                  class="error-container"
                  ng-if="dialogMode"
                  ng-show="(bulkOperationForm.bulkChannel.$dirty && bulkOperationForm.bulkChannel.$invalid) || (bulkOperationForm.bulkChannel.$touched && bulkOperationForm.bulkChannel.$invalid)"
                >
                  <small class="error" ng-show="bulkOperationForm.bulkChannel.$error.required">
                    {{ 'admin.publishing.CHANNEL' | translate }} {{ 'common.IS_REQUIRED_LABEL' | translate }}
                  </small>
                </div>
              </div>
              <div class="form-group">
                <label class="control-label" for="submissionComment"
                  >{{ 'admin.publishing.PUBLISHINGSUBMISSIONCOMMENT' | translate }}
                  <span ng-show="publish.isValidateCommentOn">*</span>
                </label>
                <textarea
                  class="form-control submission-comment"
                  id="submissionComment"
                  maxlength="{{ publish.maxCommentLength }}"
                  name="submissionComment"
                  ng-model="publish.submissionComment"
                  ng-required="publish.isValidateCommentOn"
                >
                </textarea>
                <div id="bulkPublishCharCountStatus" style="max-width: 500px"></div>
                <div
                  class="error-container"
                  ng-show="(bulkOperationForm.submissionComment.$dirty && bulkOperationForm.submissionComment.$invalid) || (bulkOperationForm.submissionComment.$touched && bulkOperationForm.submissionComment.$invalid)"
                >
                  <small class="error" ng-show="bulkOperationForm.submissionComment.$error.required">
                    {{ 'admin.publishing.PUBLISHINGSUBMISSIONCOMMENT' | translate }} {{ 'common.IS_REQUIRED_LABEL' |
                    translate }}
                  </small>
                </div>
              </div>
            </div>
          </div>
          <div class="publish-buttons">
            <input
              class="btn btn-primary"
              id="bulk-submit"
              ng-click="publish.bulkPublish()"
              ng-disabled="bulkOperationForm.$invalid || publish.disable"
              type="button"
              value="{{ 'admin.publishing.PUBLISH' | translate }}"
            />
          </div>
        </form>
      </div>
    </tab>
    <tab id="commitsTab">
      <tab-heading>
        <span class="mr10 fa fa-arrow-up"></span>{{ 'admin.publishing.PUBLISHBYCOMMITS' | translate }}
      </tab-heading>
      <div class="m10 mt25 commitsContainer">
        <h3 class="mt5 mb15">{{ 'admin.publishing.PUBLISHBYCOMMITS' | translate }}</h3>

        <form class="ng-dirty ng-invalid ng-invalid-required" id="commits-form" name="commitsForm" novalidate>
          <div class="panel">
            <div class="panel-body">
              <div class="form-group">
                <label class="control-label" for="bulkPath">{{ 'admin.publishing.COMMITIDS' | translate }}</label>
                <span class="validationComment">{{ 'admin.publishing.COMMITIDSEXAMPLE' | translate }}</span>
                <textarea
                  class="form-control"
                  focus-me="true"
                  id="commitIds"
                  name="commitIds"
                  ng-model="publish.commitIds"
                  ng-pattern-restrict="^[A-Za-z0-9,\s]*$"
                  required
                ></textarea>

                <div
                  class="error-container"
                  ng-show="(commitsForm.commitIds.$dirty && commitsForm.commitIds.$invalid) || (commitsForm.commitIds.$touched && commitsForm.commitIds.$invalid)"
                >
                  <small class="error" ng-show="commitsForm.commitIds.$error.required">
                    {{ 'admin.publishing.COMMITIDS' | translate }} {{ 'common.IS_REQUIRED_LABEL' | translate }}
                  </small>
                </div>
              </div>

              <div class="form-group">
                <label class="control-label" for="commitChannel"
                  >{{ 'admin.publishing.PUBLISHINGENVIRONMENT' | translate }}</label
                >
                <select
                  class="form-control"
                  id="commitChannel"
                  name="commitChannel"
                  ng-model="publish.selectedChannelCommit"
                  ng-options="item.name as item.name for item in publish.channels"
                >
                </select>

                <div
                  class="error-container"
                  ng-if="dialogMode"
                  ng-show="(commitsForm.commitChannel.$dirty && commitsForm.commitChannel.$invalid) || (commitsForm.commitChannel.$touched && commitsForm.commitChannel.$invalid)"
                >
                  <small class="error" ng-show="commitsForm.commitChannel.$error.required">
                    {{ 'admin.publishing.CHANNEL' | translate }} {{ 'common.REQUIRED_LABEL' | translate }}
                  </small>
                </div>
              </div>

              <div class="form-group">
                <label class="control-label" for="publishComment"
                  >{{ 'admin.publishing.COMMENT' | translate }}
                  <span ng-show="publish.isValidateCommitPublishCommentOn">*</span>
                </label>
                <textarea
                  class="form-control"
                  id="publishComment"
                  maxlength="{{ publish.maxCommentLength }}"
                  name="publishComment"
                  ng-model="publish.publishComment"
                  ng-required="publish.isValidateCommitPublishCommentOn"
                >
                </textarea>

                <div id="publishCommentCharCountStatus" style="max-width: 500px"></div>
                <div
                  class="error-container"
                  ng-show="(commitsForm.publishComment.$dirty && commitsForm.publishComment.$invalid) || (commitsForm.publishComment.$touched && commitsForm.publishComment.$invalid)"
                >
                  <small class="error" ng-show="commitsForm.publishComment.$error.required">
                    {{ 'admin.publishing.COMMENT' | translate }} {{ 'common.IS_REQUIRED_LABEL' | translate }}
                  </small>
                </div>
              </div>
            </div>
          </div>
          <div class="publish-buttons">
            <input
              class="btn btn-primary"
              id="commits-submit"
              ng-click="publish.commitsPublish()"
              ng-disabled="commitsForm.$invalid || publish.commitIdsDisable"
              type="button"
              value="{{ 'admin.publishing.PUBLISH' | translate }}"
            />
          </div>
        </form>
      </div>
    </tab>
    <tab id="publishingQueue">
      <tab-heading>
        <span class="mr10 fa fa-list-alt"></span>{{ 'admin.publishing.PUBLISHQUEUE' | translate }}
      </tab-heading>
      <div class="m10 mt25 publishingQueue" ng-init="publish.initQueque()"></div>
    </tab>
  </tabset>
</div>

<script type="text/ng-template" id="confirmationModal.html">
  <div class="modal-header">
    <h3 class="modal-title">{{ 'admin.publishing.WARNINGBP' | translate }}</h3>
  </div>
  <div class="modal-body">
    {{ 'admin.publishing.WRNINGGPBODY' | translate }}
  </div>
  <div class="modal-footer" id="bulk-publish">
    <button
      class="btn btn-primary mr10" ng-click="publish.continue(); publish.hideAdminModal()"
    >{{ 'common.YES' | translate }}
    </button>
    <button
      class="btn btn-default" ng-click="publish.hideAdminModal()"
    >{{ 'common.NO' | translate }}
    </button>
  </div>
</script>

<script type="text/ng-template" id="confirmationBulk.html">
  <div class="modal-header">
    <h3 class="modal-title">{{ 'common.NOTIFICATION' | translate }}</h3>
  </div>
  <div class="modal-body">
    {{ 'admin.publishing.PUBLISHSTARTED' | translate }}
  </div>
  <div class="modal-footer" id="confirmationBulk-btns">
    <button
      class="btn btn-primary mr10" ng-click="publish.hideConfirmationBulkModal()"
    >{{ 'common.CLOSE_LABEL' | translate }}
    </button>
  </div>
</script>

<script type="text/ng-template" id="errorDialog.html">
  <div class="modal-header">
    <h3 class="modal-title">{{ 'common.NOTIFICATION' | translate }}</h3>
  </div>
  <div class="modal-body">
    {{publish.error}}
  </div>
  <div class="modal-footer" id="errorDialog-btns">
    <button
      class="btn btn-primary mr10" ng-click="publish.hideErrorModal()"
    >{{ 'common.CLOSE_LABEL' | translate }}
    </button>
  </div>
</script>

<script type="text/ng-template" id="notificationModal.html">
  <div class="modal-header">
    <h3 class="modal-title">Notification</h3>
  </div>
  <div class="modal-body">
    <p class="notificationBody">
      <span class="icon fa fa-{{ notificationType }}"></span>
      <span class="text"> {{ notificationText }}</span>
    </p>
  </div>
</script>
